generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model
model User {
  id        String    @id @default(uuid()) // Internal UUID for the user
  kindeId   String    @unique // Kinde Auth user ID
  email     String    @unique
  firstName String? // From Kinde Auth (e.g., given_name)
  lastName  String? // From Kinde Auth (e.g., family_name)
  picture   String? // Profile picture URL (from Kinde)
  bio       String? // User bio (editable in settings)
  lastLogin DateTime? // Track last login time
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relationships
  bookmarks   Bookmark[]
  collections Collection[]

  // Indexes
  @@index([kindeId], name: "user_kindeId_idx") // For Kinde Auth lookups
  @@index([email], name: "user_email_idx") // For email-based lookups
}

// Bookmark model
model Bookmark {
  id              String    @id @default(uuid())
  title           String // Bookmark title
  url             String    @unique // Bookmark URL
  description     String? // Optional notes or description
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  isFavorite      Boolean   @default(false) // For "Favorites" subcategory
  isUncategorized Boolean   @default(true) // For "Uncategorized" subcategory (true if no collection)
  revisitAt       DateTime? // For "Revisit Later" subcategories (nullable)
  faviconUrl      String? // URL for favicon (optional, for UI display)
  thumbnailUrl    String? // URL for thumbnail/preview image (optional, for UI display)
  metadata        Json? // Store additional metadata (e.g., page title, description from URL)

  // Relationships
  userId       String
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  collectionId String? // Optional reference to a collection (subfolder)
  collection   Collection? @relation(fields: [collectionId], references: [id], onDelete: SetNull)

  // Indexes
  @@index([userId], name: "bookmark_userId_idx") // For user-based lookups
  @@index([collectionId], name: "bookmark_collectionId_idx") // For collection-based lookups
  @@index([createdAt], name: "bookmark_createdAt_idx") // For "Recently Added"
  @@index([revisitAt], name: "bookmark_revisitAt_idx") // For "Revisit Later"
  @@index([title], name: "bookmark_title_idx") // For future searches
  @@index([description], name: "bookmark_description_idx") // For future searches
}

// Collection model
model Collection {
  id        String   @id @default(uuid())
  name      String // Collection name (e.g., "Work")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  userId    String
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  bookmarks Bookmark[] // Bookmarks in this collection
  parentId  String? // For nested collections (e.g., sub-subfolders)
  parent    Collection?  @relation("CollectionHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children  Collection[] @relation("CollectionHierarchy")

// Uniqueness constraint
  @@unique([userId, name, parentId], name: "collection_userId_name_parentId_unique")

  // Indexes
  @@index([userId], name: "collection_userId_idx") // For user-based lookups
  @@index([parentId], name: "collection_parentId_idx") // For hierarchical lookups
  @@index([name], name: "collection_name_idx") // For name-based lookups
}
